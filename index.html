<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Smartphone Hidden Camera Detector</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        background: radial-gradient(circle, #0f2027, #203a43, #2c5364);
        color: #00fff5;
        text-align: center;
        padding: 20px;
        font-family: 'Poppins', sans-serif;
    }
    h1 {
        font-size: 2rem;
        color: #00f0ff;
        margin-bottom: 20px;
        text-shadow: 0 0 10px #00fff5, 0 0 20px #00fff5;
    }
    #video {
        border: 3px solid #00fff5;
        border-radius: 15px;
        box-shadow: 0 0 20px #00fff5;
        max-width: 100%;
    }
    #strengthBar {
        width: 80%;
        height: 25px;
        margin-top: 20px;
        accent-color: #00fff5;
    }
    .alert-text {
        font-size: 1.2rem;
        color: #ff004c;
        margin-top: 15px;
        padding: 15px;
        background: rgba(255,0,76,0.15);
        border: 2px solid #ff004c;
        border-radius: 10px;
        text-shadow: 0 0 10px #ff004c;
        display: none;
        animation: blink 0.8s infinite alternate;
    }
    @keyframes blink { from {opacity:1;} to{opacity:0.5;} }
    .slider-and-button { margin-top: 20px; color: #00fff5; }
    input[type=range] { width: 60%; accent-color: #00fff5; }
    .neon-btn { display:inline-block; padding:12px 20px; color:#00fff5; font-size:1rem; border:2px solid #00fff5; border-radius:10px; background:transparent; margin:10px; transition:0.3s; }
    .neon-btn:hover { background:#00fff5; color:#000; box-shadow:0 0 15px #00fff5; }
</style>
</head>
<body>
<h1>üö® Smartphone Hidden Camera Detector</h1>

<video id="video" width="100%" height="auto" autoplay playsinline></video>
<canvas id="canvas" width="640" height="480" style="display:none;"></canvas>

<progress id="strengthBar" value="0" max="100"></progress>
<div class="alert-text" id="alertText">‚ö†Ô∏è Potential Hidden Camera Detected!</div>

<div class="slider-and-button">
    <label>Sensitivity (Threshold): <span id="thresholdValue">240</span></label><br>
    <input type="range" id="thresholdRange" min="200" max="255" value="240">
</div>

<button class="neon-btn" id="startButton">Start Detection üîä</button>
<button class="neon-btn" id="switchButton">Switch Camera üîÑ</button>

<script>
let video = document.getElementById("video");
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let strengthBar = document.getElementById("strengthBar");
let alertText = document.getElementById("alertText");
let thresholdRange = document.getElementById("thresholdRange");
let thresholdValue = document.getElementById("thresholdValue");
let startButton = document.getElementById("startButton");
let switchButton = document.getElementById("switchButton");

let threshold = parseInt(thresholdRange.value);
let audioCtx, osc, gainNode;
let consecutiveCount = 0;
let currentStream;
let useRearCamera = true; // default to rear camera

thresholdRange.addEventListener("input", () => {
    threshold = parseInt(thresholdRange.value);
    thresholdValue.textContent = threshold;
});

// Function to initialize camera (front/rear)
async function initCamera() {
    if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
    }
    const constraints = {
        video: {
            facingMode: useRearCamera ? { exact: "environment" } : "user",
            width: { ideal: 1280 },
            height: { ideal: 720 }
        },
        audio: false
    };
    try {
        currentStream = await navigator.mediaDevices.getUserMedia(constraints);
        video.srcObject = currentStream;
        await video.play();
    } catch (err) {
        alert("Camera access error: " + err.message);
    }
}

// Switch camera button
switchButton.addEventListener("click", () => {
    useRearCamera = !useRearCamera;
    initCamera();
});

// Start detection
startButton.addEventListener("click", () => {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    osc = audioCtx.createOscillator();
    gainNode = audioCtx.createGain();
    osc.connect(gainNode).connect(audioCtx.destination);
    osc.type = "sine";
    osc.frequency.value = 0;
    gainNode.gain.value = 0;
    osc.start();

    detectLoop();
    startButton.disabled = true;
});

// Detection loop
function detectLoop() {
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
    let brightSpots = 0;

    // Check central 200x200 area
    const startX = canvas.width / 2 - 100;
    const startY = canvas.height / 2 - 100;
    for (let y = startY; y < startY + 200; y += 5) {
        for (let x = startX; x < startX + 200; x += 5) {
            const i = (y * canvas.width + x) * 4;
            const b = (frame.data[i] + frame.data[i+1] + frame.data[i+2]) / 3;
            if (b > threshold) brightSpots++;
        }
    }

    const strength = Math.min(brightSpots, 200);
    strengthBar.value = (strength / 200) * 100;

    if (strength > 5) consecutiveCount++;
    else consecutiveCount = 0;

    if (consecutiveCount >= 5) {
        alertText.style.display = "block";
        osc.frequency.value = 300 + strength * 2;
        gainNode.gain.value = 0.3;
    } else {
        alertText.style.display = "none";
        osc.frequency.value = 0;
        gainNode.gain.value = 0;
    }

    requestAnimationFrame(detectLoop);
}

// Initialize rear camera on load
window.addEventListener('load', initCamera);
</script>
</body>
</html>
